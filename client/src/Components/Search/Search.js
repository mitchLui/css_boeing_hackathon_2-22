import "./Search.css";
import {FontAwesomeIcon} from "@fortawesome/react-fontawesome";
import {faL, faXmark} from "@fortawesome/free-solid-svg-icons";
import {token} from "../Map/Mapbox";
import {useState} from "react";

export const Search = ({searchBarVisibility, setSearchBarVisibility, lat, lng, setCentre, setInfo}) => {
    const [suggestions, setSuggestions] = useState([]);
    const geocode = (q) => {
        const params = {
            access_token: process.env.REACT_APP_MAPBOX_API_TOKEN,
            proximity: `${lat},${lng}`,
        }
        const url = new URL(`https://api.mapbox.com/geocoding/v5/mapbox.places/${q}.json`);
        url.search = new URLSearchParams(params).toString();
        fetch(url).then(resp => resp.json()).then(({features}) => {
            setSuggestions(features.map(feature => ({
                name: feature["place_name"],
                coords: feature["center"],
            })));
        })
    }

    return (
        <div className={"modal"}>
            <div>
                <button className={"close"} onClick={() => setSearchBarVisibility(!searchBarVisibility)}>
                    <FontAwesomeIcon icon={faXmark}/>
                </button>
                <form>
                    <label htmlFor={"search"}>Search</label>
                    <input type={"text"} id={"search"} placeholder={"Enter Search Term"}
                        onChange={({target: {value}}) => geocode(value)}/>
                    <div className={"suggestions"}>
                        {
                            suggestions.map((place, key) => <div className={"suggestion"} onClick={() => {
                                setSearchBarVisibility(false);
                                setCentre([place.coords[1], place.coords[0]]);
                                // fetch("https://eb4a-82-37-67-117.ngrok.io/navigation/?src_long=-2.6027&src_lat=51.4545&dest_long=-2.6220&dest_lat=51.4637")
                                // .then(res => res.json()).then(j => {setInfo(j.data);});
                                setInfo(JSON.parse(`{"data":{"routes":[{"dep_time":"2022-03-13T13:48:27.926478+00:00","arr_time":"2022-03-13T13:56:27.308133+00:00","time":7.989000000000001,"emissions":18.92,"dist":2663,"legs":[{"mode":"walk","dist":172,"path":[[[-2.60275,51.45448],[-2.6032,51.45483],[-2.60358,51.45512],[-2.60362,51.45515],[-2.60326,51.45533],[-2.60307,51.45542],[-2.60295,51.45552],[-2.60277,51.45549]],[[-2.60275,51.45448],[-2.6032,51.45483],[-2.60358,51.45512],[-2.60362,51.45515],[-2.60326,51.45533],[-2.60307,51.45542],[-2.60295,51.45552],[-2.60277,51.45549]]],"cost":0},{"mode":"voi","dist":2190,"path":[[[-2.60277,51.45549],[-2.60295,51.45552],[-2.60361,51.45568],[-2.60386,51.45574],[-2.60396,51.45576],[-2.60422,51.45579],[-2.60429,51.45579],[-2.60444,51.45581],[-2.60459,51.45583],[-2.60473,51.45586],[-2.60493,51.45589],[-2.60537,51.45597],[-2.60563,51.45599],[-2.60578,51.456],[-2.60598,51.45602],[-2.60619,51.45604],[-2.60643,51.45605],[-2.60669,51.45606],[-2.607,51.45606],[-2.60721,51.45606],[-2.60755,51.45605],[-2.60787,51.45608],[-2.60793,51.45609],[-2.60796,51.45611],[-2.608,51.45613],[-2.60803,51.45616],[-2.60805,51.45621],[-2.60804,51.45628],[-2.608,51.45644],[-2.60797,51.45662],[-2.60793,51.45676],[-2.60793,51.45687],[-2.60794,51.45696],[-2.60796,51.45703],[-2.60802,51.45709],[-2.60817,51.45718],[-2.60848,51.45734],[-2.60889,51.45756],[-2.60906,51.45766],[-2.60931,51.45779],[-2.60962,51.45791],[-2.60972,51.45794],[-2.60981,51.45797],[-2.61014,51.45801],[-2.61028,51.45802],[-2.61043,51.45802],[-2.61078,51.45804],[-2.61113,51.45803],[-2.61121,51.45803],[-2.6116,51.458],[-2.61185,51.45798],[-2.61192,51.45794],[-2.61196,51.45793],[-2.61214,51.4579],[-2.61228,51.45787],[-2.61231,51.45785],[-2.61235,51.45784],[-2.61239,51.45784],[-2.61254,51.45778],[-2.61267,51.45769],[-2.61281,51.45772],[-2.61312,51.45786],[-2.61321,51.4579],[-2.61366,51.45809],[-2.61378,51.45814],[-2.61394,51.45822],[-2.61402,51.45828],[-2.61409,51.45834],[-2.61428,51.45849],[-2.61447,51.45867],[-2.61478,51.45901],[-2.61513,51.45887],[-2.61542,51.45874],[-2.61572,51.45863],[-2.6159,51.4586],[-2.61663,51.45858],[-2.61677,51.45856],[-2.61692,51.45854],[-2.61728,51.45848],[-2.61834,51.45826],[-2.61858,51.45875],[-2.61877,51.45907],[-2.6188,51.45913],[-2.61885,51.45917],[-2.619,51.45931],[-2.61916,51.45945],[-2.61959,51.4598],[-2.61985,51.46002],[-2.61986,51.46003],[-2.62015,51.46028],[-2.62043,51.46054],[-2.62097,51.46107],[-2.62114,51.46123],[-2.62137,51.46146],[-2.62154,51.46162],[-2.62178,51.46181],[-2.62197,51.46195],[-2.62198,51.46196],[-2.62213,51.46204],[-2.62288,51.46244],[-2.62299,51.46249],[-2.62351,51.46276],[-2.62366,51.46284],[-2.62381,51.46293],[-2.62388,51.46298],[-2.62427,51.46322],[-2.62444,51.46333],[-2.6245,51.46337],[-2.62437,51.46345],[-2.62427,51.46351],[-2.6242,51.46355],[-2.62414,51.46359],[-2.62399,51.46368],[-2.62379,51.46378],[-2.6234,51.46398],[-2.6231,51.46413],[-2.62295,51.4642]],[[-2.60277,51.45549],[-2.60295,51.45552],[-2.60361,51.45568],[-2.60386,51.45574],[-2.60396,51.45576],[-2.60422,51.45579],[-2.60429,51.45579],[-2.60444,51.45581],[-2.60459,51.45583],[-2.60473,51.45586],[-2.60493,51.45589],[-2.60537,51.45597],[-2.60563,51.45599],[-2.60578,51.456],[-2.60598,51.45602],[-2.60619,51.45604],[-2.60643,51.45605],[-2.60669,51.45606],[-2.607,51.45606],[-2.60721,51.45606],[-2.60755,51.45605],[-2.60787,51.45608],[-2.60793,51.45609],[-2.60796,51.45611],[-2.608,51.45613],[-2.60803,51.45616],[-2.60805,51.45621],[-2.60804,51.45628],[-2.608,51.45644],[-2.60797,51.45662],[-2.60793,51.45676],[-2.60793,51.45687],[-2.60794,51.45696],[-2.60796,51.45703],[-2.60802,51.45709],[-2.60817,51.45718],[-2.60848,51.45734],[-2.60889,51.45756],[-2.60906,51.45766],[-2.60931,51.45779],[-2.60962,51.45791],[-2.60972,51.45794],[-2.60981,51.45797],[-2.61014,51.45801],[-2.61028,51.45802],[-2.61043,51.45802],[-2.61078,51.45804],[-2.61113,51.45803],[-2.61121,51.45803],[-2.6116,51.458],[-2.61185,51.45798],[-2.61192,51.45794],[-2.61196,51.45793],[-2.61214,51.4579],[-2.61228,51.45787],[-2.61231,51.45785],[-2.61235,51.45784],[-2.61239,51.45784],[-2.61254,51.45778],[-2.61267,51.45769],[-2.61281,51.45772],[-2.61312,51.45786],[-2.61321,51.4579],[-2.61366,51.45809],[-2.61378,51.45814],[-2.61394,51.45822],[-2.61402,51.45828],[-2.61409,51.45834],[-2.61428,51.45849],[-2.61447,51.45867],[-2.61478,51.45901],[-2.61513,51.45887],[-2.61542,51.45874],[-2.61572,51.45863],[-2.6159,51.4586],[-2.61663,51.45858],[-2.61677,51.45856],[-2.61692,51.45854],[-2.61728,51.45848],[-2.61834,51.45826],[-2.61858,51.45875],[-2.61877,51.45907],[-2.6188,51.45913],[-2.61885,51.45917],[-2.619,51.45931],[-2.61916,51.45945],[-2.61959,51.4598],[-2.61985,51.46002],[-2.61986,51.46003],[-2.62015,51.46028],[-2.62043,51.46054],[-2.62097,51.46107],[-2.62114,51.46123],[-2.62137,51.46146],[-2.62154,51.46162],[-2.62178,51.46181],[-2.62197,51.46195],[-2.62198,51.46196],[-2.62213,51.46204],[-2.62288,51.46244],[-2.62299,51.46249],[-2.62351,51.46276],[-2.62366,51.46284],[-2.62381,51.46293],[-2.62388,51.46298],[-2.62427,51.46322],[-2.62444,51.46333],[-2.6245,51.46337],[-2.62437,51.46345],[-2.62427,51.46351],[-2.6242,51.46355],[-2.62414,51.46359],[-2.62399,51.46368],[-2.62379,51.46378],[-2.6234,51.46398],[-2.6231,51.46413],[-2.62295,51.4642]]],"cost":2.5978000000000003},{"mode":"walk","dist":301,"path":[[[-2.62295,51.4642],[-2.6231,51.46413],[-2.6234,51.46398],[-2.62379,51.46378],[-2.62399,51.46368],[-2.62395,51.46364],[-2.62388,51.46359],[-2.62378,51.4635],[-2.62355,51.46359],[-2.62313,51.46377],[-2.62311,51.46378],[-2.62288,51.46386],[-2.62279,51.4638],[-2.62266,51.46385],[-2.62256,51.46376],[-2.62252,51.46374],[-2.62213,51.46358],[-2.62207,51.46353],[-2.62193,51.46358],[-2.62179,51.4636],[-2.62177,51.4636],[-2.62178,51.46361],[-2.62179,51.46363],[-2.62181,51.46362],[-2.62186,51.46361],[-2.62192,51.4636]],[[-2.62295,51.4642],[-2.6231,51.46413],[-2.6234,51.46398],[-2.62379,51.46378],[-2.62399,51.46368],[-2.62395,51.46364],[-2.62388,51.46359],[-2.62378,51.4635],[-2.62355,51.46359],[-2.62313,51.46377],[-2.62311,51.46378],[-2.62288,51.46386],[-2.62279,51.4638],[-2.62266,51.46385],[-2.62256,51.46376],[-2.62252,51.46374],[-2.62213,51.46358],[-2.62207,51.46353],[-2.62193,51.46358],[-2.62179,51.4636],[-2.62177,51.4636],[-2.62178,51.46361],[-2.62179,51.46363],[-2.62181,51.46362],[-2.62186,51.46361],[-2.62192,51.4636]]],"cost":0}]},{"time":21,"dist":3453,"legs":[{"dist":239,"mode":"walk","path":[[-2.6027,51.4545],[-2.602746,51.454477],[-2.603195,51.45483],[-2.603578,51.455119],[-2.603621,51.455153],[-2.604236,51.455629],[-2.604346,51.455686],[-2.604427,51.455737],[-2.604472,51.455761],[-2.604586,51.455831],[-2.604735,51.455857],[-2.604929,51.455891],[-2.605168,51.455932],[-2.605178,51.455911]],"dep_time":"2022-03-13T13:57:00+00:00","arr_time":"2022-03-13T14:01:00+00:00","src":"Journey Origin","dest":"Journey Origin","line":""},{"dist":2940,"mode":"bus","path":[[-2.605178,51.455911],[-2.608021,51.456525],[-2.609781,51.457883],[-2.613096,51.457173],[-2.615131,51.455427],[-2.619553,51.455692],[-2.618107,51.458397],[-2.615096,51.459303],[-2.616365,51.461607],[-2.617879,51.463928],[-2.619486,51.465646],[-2.621298,51.465537],[-2.624395,51.463561]],"dep_time":"2022-03-13T14:01:00+00:00","arr_time":"2022-03-13T14:14:00+00:00","src":"Park Street Top (U6), Queen's Road, Tyndall's Park","dest":"Park Street Top (U6), Queen's Road, Tyndall's Park","line":"8"},{"dist":274,"mode":"walk","path":[[-2.624395,51.463561],[-2.624419,51.463583],[-2.624484,51.463551],[-2.624558,51.463543],[-2.624603,51.463522],[-2.624569,51.463473],[-2.624558,51.463452],[-2.62456,51.463417],[-2.624496,51.463374],[-2.624366,51.463448],[-2.62427,51.463508],[-2.624199,51.463551],[-2.62414,51.463588],[-2.62399,51.463677],[-2.623951,51.463643],[-2.623876,51.463585],[-2.62378,51.463497],[-2.62372,51.463454],[-2.623658,51.463477],[-2.623656,51.463454],[-2.623633,51.463456],[-2.623606,51.463458],[-2.623544,51.463459],[-2.623498,51.463471],[-2.623146,51.46361],[-2.622823,51.463737],[-2.622771,51.463692],[-2.622674,51.463731],[-2.622725,51.463775],[-2.622676,51.463795],[-2.622581,51.463832],[-2.622537,51.463849],[-2.622533,51.463832],[-2.62236,51.463716],[-2.622257,51.463664],[-2.622154,51.463611],[-2.622082,51.463568],[-2.622055,51.463552],[-2.621979,51.463578],[-2.621921,51.463595],[-2.622,51.4637]],"dep_time":"2022-03-13T14:14:00+00:00","arr_time":"2022-03-13T14:18:00+00:00","src":"Bristol Zoo (Sw Bound), Clifton Down, Clifton","dest":"Bristol Zoo (Sw Bound), Clifton Down, Clifton","line":""}],"dep_time":"2022-03-13T13:57:00+00:00","arr_time":"2022-03-13T14:18:00+00:00","emissions":120.86},{"time":22,"dist":3037,"legs":[{"dist":467,"mode":"walk","path":[[-2.6027,51.4545],[-2.602746,51.454477],[-2.603195,51.45483],[-2.603578,51.455119],[-2.603621,51.455153],[-2.604236,51.455629],[-2.604346,51.455686],[-2.604427,51.455737],[-2.604472,51.455761],[-2.604586,51.455831],[-2.604735,51.455857],[-2.604929,51.455891],[-2.605366,51.455966],[-2.605626,51.455994],[-2.60578,51.456003],[-2.605982,51.456016],[-2.60619,51.456035],[-2.606432,51.456047],[-2.606693,51.456056],[-2.606996,51.456061],[-2.607207,51.456062],[-2.607209,51.456111],[-2.607212,51.456205],[-2.607215,51.456314],[-2.607319,51.456355],[-2.607573,51.456414],[-2.607742,51.456425],[-2.60787,51.456435],[-2.608004,51.456443],[-2.607989,51.456523],[-2.608021,51.456525]],"dep_time":"2022-03-13T14:01:00+00:00","arr_time":"2022-03-13T14:08:00+00:00","src":"Journey Origin","dest":"Journey Origin","line":""},{"dist":2239,"mode":"bus","path":[[-2.608021,51.456525],[-2.609781,51.457883],[-2.613096,51.457173],[-2.615131,51.455427],[-2.619553,51.455692],[-2.621169,51.457059],[-2.626747,51.45872],[-2.626319,51.462139],[-2.62394,51.463959]],"dep_time":"2022-03-13T14:08:00+00:00","arr_time":"2022-03-13T14:18:00+00:00","src":"Triangle West (U3), Triangle West, Tyndall's Park","dest":"Triangle West (U3), Triangle West, Tyndall's Park","line":"505"},{"dist":331,"mode":"walk","path":[[-2.62394,51.463959],[-2.623857,51.463895],[-2.624029,51.463808],[-2.624248,51.463696],[-2.624325,51.463658],[-2.624361,51.463611],[-2.624419,51.463583],[-2.624484,51.463551],[-2.624558,51.463543],[-2.624603,51.463522],[-2.624569,51.463473],[-2.624558,51.463452],[-2.62456,51.463417],[-2.624496,51.463374],[-2.624366,51.463448],[-2.62427,51.463508],[-2.624199,51.463551],[-2.62414,51.463588],[-2.62399,51.463677],[-2.623951,51.463643],[-2.623876,51.463585],[-2.62378,51.463497],[-2.62372,51.463454],[-2.623658,51.463477],[-2.623656,51.463454],[-2.623633,51.463456],[-2.623606,51.463458],[-2.623544,51.463459],[-2.623498,51.463471],[-2.623146,51.46361],[-2.622823,51.463737],[-2.622771,51.463692],[-2.622674,51.463731],[-2.622725,51.463775],[-2.622676,51.463795],[-2.622581,51.463832],[-2.622537,51.463849],[-2.622533,51.463832],[-2.62236,51.463716],[-2.622257,51.463664],[-2.622154,51.463611],[-2.622082,51.463568],[-2.622055,51.463552],[-2.621979,51.463578],[-2.621921,51.463595],[-2.622,51.4637]],"dep_time":"2022-03-13T14:18:00+00:00","arr_time":"2022-03-13T14:23:00+00:00","src":"Bristol Zoo (Ne Bound), Clifton Down, Clifton","dest":"Bristol Zoo (Ne Bound), Clifton Down, Clifton","line":""}],"dep_time":"2022-03-13T14:01:00+00:00","arr_time":"2022-03-13T14:23:00+00:00","emissions":106.3},{"time":28,"dist":2931,"legs":[{"dist":260,"mode":"walk","path":[[-2.6027,51.4545],[-2.602746,51.454477],[-2.603195,51.45483],[-2.603578,51.455119],[-2.603621,51.455153],[-2.604236,51.455629],[-2.604346,51.455686],[-2.604427,51.455737],[-2.604472,51.455761],[-2.604586,51.455831],[-2.604735,51.455857],[-2.604929,51.455891],[-2.605366,51.455966],[-2.60549,51.455979],[-2.605495,51.455963]],"dep_time":"2022-03-13T14:03:00+00:00","arr_time":"2022-03-13T14:07:00+00:00","src":"Journey Origin","dest":"Journey Origin","line":""},{"dist":1537,"mode":"bus","path":[[-2.605495,51.455963],[-2.608021,51.456525],[-2.608599,51.461],[-2.609577,51.464196],[-2.613083,51.468044]],"dep_time":"2022-03-13T14:07:00+00:00","arr_time":"2022-03-13T14:14:00+00:00","src":"Park Street Top (U1), Queen's Road, Tyndall's Park","dest":"Park Street Top (U1), Queen's Road, Tyndall's Park","line":"4"},{"dist":1134,"mode":"walk","path":[[-2.613083,51.468044],[-2.613053,51.468058],[-2.613262,51.46824],[-2.613368,51.468323],[-2.613499,51.468276],[-2.613583,51.468247],[-2.613657,51.468232],[-2.61481,51.467499],[-2.61449,51.466913],[-2.614321,51.466508],[-2.614425,51.466463],[-2.615523,51.465782],[-2.616269,51.465328],[-2.617233,51.464663],[-2.618083,51.464272],[-2.618002,51.464164],[-2.617633,51.463812],[-2.618406,51.463492],[-2.618668,51.463392],[-2.618823,51.463324],[-2.619606,51.462983],[-2.619747,51.462922],[-2.620445,51.46263],[-2.620539,51.462721],[-2.620598,51.462782],[-2.620539,51.462812],[-2.620559,51.462874],[-2.620587,51.462908],[-2.620658,51.462977],[-2.620665,51.46299],[-2.620686,51.463031],[-2.620695,51.463123],[-2.620702,51.463192],[-2.620767,51.463197],[-2.620847,51.463208],[-2.620896,51.463162],[-2.620999,51.46317],[-2.621109,51.463195],[-2.621334,51.463242],[-2.621367,51.463236],[-2.62141,51.463228],[-2.621513,51.463257],[-2.621506,51.463293],[-2.621523,51.463303],[-2.621577,51.463344],[-2.621613,51.463396],[-2.621627,51.463448],[-2.621633,51.463529],[-2.621606,51.463613],[-2.621771,51.463601],[-2.621776,51.46361],[-2.621789,51.463631],[-2.621811,51.463625],[-2.621863,51.463611],[-2.621917,51.463596],[-2.622,51.4637]],"dep_time":"2022-03-13T14:14:00+00:00","arr_time":"2022-03-13T14:31:00+00:00","src":"Apsley Road (Nw Bound), Whiteladies Road, Clifton","dest":"Apsley Road (Nw Bound), Whiteladies Road, Clifton","line":""}],"dep_time":"2022-03-13T14:03:00+00:00","arr_time":"2022-03-13T14:31:00+00:00","emissions":102.59},{"time":21,"dist":3453,"legs":[{"dist":239,"mode":"walk","path":[[-2.6027,51.4545],[-2.602746,51.454477],[-2.603195,51.45483],[-2.603578,51.455119],[-2.603621,51.455153],[-2.604236,51.455629],[-2.604346,51.455686],[-2.604427,51.455737],[-2.604472,51.455761],[-2.604586,51.455831],[-2.604735,51.455857],[-2.604929,51.455891],[-2.605168,51.455932],[-2.605178,51.455911]],"dep_time":"2022-03-13T14:12:00+00:00","arr_time":"2022-03-13T14:16:00+00:00","src":"Journey Origin","dest":"Journey Origin","line":""},{"dist":2940,"mode":"bus","path":[[-2.605178,51.455911],[-2.608021,51.456525],[-2.609781,51.457883],[-2.613096,51.457173],[-2.615131,51.455427],[-2.619553,51.455692],[-2.618107,51.458397],[-2.615096,51.459303],[-2.616365,51.461607],[-2.617879,51.463928],[-2.619486,51.465646],[-2.621298,51.465537],[-2.624395,51.463561]],"dep_time":"2022-03-13T14:16:00+00:00","arr_time":"2022-03-13T14:29:00+00:00","src":"Park Street Top (U6), Queen's Road, Tyndall's Park","dest":"Park Street Top (U6), Queen's Road, Tyndall's Park","line":"8"},{"dist":274,"mode":"walk","path":[[-2.624395,51.463561],[-2.624419,51.463583],[-2.624484,51.463551],[-2.624558,51.463543],[-2.624603,51.463522],[-2.624569,51.463473],[-2.624558,51.463452],[-2.62456,51.463417],[-2.624496,51.463374],[-2.624366,51.463448],[-2.62427,51.463508],[-2.624199,51.463551],[-2.62414,51.463588],[-2.62399,51.463677],[-2.623951,51.463643],[-2.623876,51.463585],[-2.62378,51.463497],[-2.62372,51.463454],[-2.623658,51.463477],[-2.623656,51.463454],[-2.623633,51.463456],[-2.623606,51.463458],[-2.623544,51.463459],[-2.623498,51.463471],[-2.623146,51.46361],[-2.622823,51.463737],[-2.622771,51.463692],[-2.622674,51.463731],[-2.622725,51.463775],[-2.622676,51.463795],[-2.622581,51.463832],[-2.622537,51.463849],[-2.622533,51.463832],[-2.62236,51.463716],[-2.622257,51.463664],[-2.622154,51.463611],[-2.622082,51.463568],[-2.622055,51.463552],[-2.621979,51.463578],[-2.621921,51.463595],[-2.622,51.4637]],"dep_time":"2022-03-13T14:29:00+00:00","arr_time":"2022-03-13T14:33:00+00:00","src":"Bristol Zoo (Sw Bound), Clifton Down, Clifton","dest":"Bristol Zoo (Sw Bound), Clifton Down, Clifton","line":""}],"dep_time":"2022-03-13T14:12:00+00:00","arr_time":"2022-03-13T14:33:00+00:00","emissions":120.86}]},"message":"Got data for directions from 51.4545, -2.6027 to 51.4637, -2.622","success":true}`).data);
                            }}>{place.name}</div>)
                        }
                    </div>
                </form>
            </div>
        </div>
    )
}